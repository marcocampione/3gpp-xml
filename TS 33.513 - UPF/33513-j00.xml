<?xml version="1.0" ?>
<Specification name="3GPP TS 33.513">
  <Section title="Foreword" level="1"/>
  <Section title="1	Scope" level="1"/>
  <Section title="2	References" level="1"/>
  <Section title="3	Definitions of terms, symbols and abbreviations" level="1">
    <Section title="3.1	Terms" level="2"/>
    <Section title="3.2	Symbols" level="2"/>
    <Section title="3.3	Abbreviations" level="2"/>
  </Section>
  <Section title="4	UPF-specific security requirements and related test cases" level="1">
    <Section title="4.1	Introduction" level="2"/>
    <Section title="4.2	UPF-specific security functional requirements and related test cases" level="2">
      <Section title="4.2.1	Introduction" level="3"/>
      <Section title="4.2.2	Security functional requirements on the UPF deriving from 3GPP specifications and related test cases" level="3">
        <Section title="4.2.2.0	General" level="4"/>
        <Section title="4.2.2.1	Confidentiality protection of user data transported over N3 interface" level="4">
          <Requirement>
            <Name>Confidentiality protection of user data transported over N3 interface.</Name>
            <Reference>TS 33.501 [2], Clause 9.3</Reference>
            <Description>The transported user data between gNB and UPF is confidentiality protected as specified in TS 33.501 [2], clause 9.3.
Threat Reference: TR 33.926 [7], Clause L.2.2, &quot;No protection or weak protection for user plane data &quot;.
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPSec in N3 interface without the use of a SEG.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_UP_DATA_CONF_UPF</Name>
            <Purpose>Verify that the transported user data between gNB and UPF are confidentiality protected over N3 interface.
Procedure and execution steps:
Pre-Condition:
-	UPF network product is connected in simulated/real network environment.
-	The tunnel mode IPsec ESP and IKE certificate authentication is implemented.
-	Tester shall have knowledge of the security parameters of tunnel for decrypting the ESP packets.
-	Tester shall have access to the N3 interface between gNB and UPF.
-	Tester shall have knowledge of the confidentiality algorithm and confidentiality protection keys used for encrypting the encapsulated payload.</Purpose>
            <ExecutionSteps>The requirement mentioned in this clause is tested in accordance with the procedure mentioned in clause 4.2.3.2.4 of TS 33.117 [3].</ExecutionSteps>
            <ExpectedResults>The user data transported between gNB and UPF is confidentiality protected.</ExpectedResults>
            <EvidenceFormat>Evidence suitable for the interface, e.g., evidence can be presented in the form of screenshot/screen-capture.</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.2	Integrity protection of user data transported over N3 interface" level="4">
          <Requirement>
            <Name>Integrity protection of user data transported over N3 interface.</Name>
            <Reference>TS 33.501 [2], Clause 9.3</Reference>
            <Description>The transported user data between gNB and UPF is integrity protected as specified in TS 33.501 [2], clause 9.3.
Threat Reference: TR 33.926 [7], Clause L.2.2, &quot;No protection or weak protection for user plane data&quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPSec in N3 interface without the use of a SEG</Description>
          </Requirement>
          <TestCase>
            <Name>TC_UP_DATA_INT_UPF</Name>
            <Purpose>Verify that the transported user data between gNB and UPF are integrity protected over N3 interface.
Procedure and execution steps:
Pre-Condition:
-	UPF network product is connected in simulated/real network environment.
-	The tunnel mode IPsec ESP and IKE certificate authentication is implemented.
-	Tester shall have knowledge of the security parameters of tunnel for decrypting the Encapsulated Security Payload (ESP) packets.
-	Tester shall have knowledge of the authentication algorithm (Hash Message Authentication Code) and the protection keys.</Purpose>
            <ExecutionSteps>The requirement mentioned in this clause is tested in accordance to the procedure mentioned in clause 4.2.3.2.4 of TS 33.117 [3].</ExecutionSteps>
            <ExpectedResults>The user data transported between gNB and UPF is integrity protected.</ExpectedResults>
            <EvidenceFormat>Evidence suitable for the interface, e.g., evidence can be presented in the form of screenshot/screen-capture.</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.3	Replay protection of user data transported over N3 interface" level="4">
          <Requirement>
            <Name>Replay protection of user data transported over N3 interface</Name>
            <Reference>TS 33.501 [2], Clause 9.3</Reference>
            <Description>The transported user data between gNB and UPF is replay protected as specified in TS 33.501, clause 9.3.
Threat Reference: TR 33.926 [7], Clause L.2.2, &quot;No protection or weak protection for user plane data&quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPSec in N3 interface without the use of a SEG.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_UP_DATA_REPLAY_UPF</Name>
            <Purpose>Verify that the transported user data between gNB and UPF are replay protected.
Procedure and execution steps:
The following procedure is executed if UPF supports IPsec.
Pre-Condition:
-	UPF network product is connected in simulated/real network environment.
-	The tunnel mode IPsec ESP and IKE certificate authentication is implemented.
-	Tester shall have knowledge of the security parameters of tunnel for decrypting the ESP packets.
-	Tester shall have access to the original user data transported via N3 reference point between gNB and UPF.</Purpose>
            <ExecutionSteps>The requirement mentioned in this clause is tested in accordance with the procedure mentioned in clause 4.2.3.2.4 of TS 33.117 [3].</ExecutionSteps>
            <ExpectedResults>The user data transported between UE and UPF is replay protected.</ExpectedResults>
            <EvidenceFormat>Evidence suitable for the interface, e.g., evidence can be presented in the form of screenshot/screen-capture.</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.4	Protection of user data transported over N9 interface Within a PLMN" level="4">
          <Requirement>
            <Name>Protection of user data transported over N9 within a PLMN.</Name>
            <Reference>TS 33.501 [2], Clause 9.9</Reference>
            <Description>As specified in clause 9.9 in TS 33.501 [2], interfaces internal to the 5G Core can be used to transport signalling data as well as privacy sensitive material, such as user and subscription data, or other parameters, such as security keys. Therefore, confidentiality and integrity protection is required.
For the protection of the non-SBA internal interfaces, such as N4 and N9, NDS/IP is used as specified in TS 33.501 [2], clause 9.9 .
Threat Reference: TR 33.926 [7], Clause L.2.2, &quot;No protection or weak protection for user plane data &quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPSec in N3 interface without the use of a SEG.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_UP_DATA_CONF_UPF_N9</Name>
            <Purpose>Verify that the protection mechanism implemented for user data transport over N9 interface in a PLMN conforms to the selected security profile.
Procedure and execution steps:
Pre-Condition:
-	UPF network products are connected in simulated/real network environment.
-	The tunnel mode IPsec ESP and IKE certificate authentication is implemented.
-	Tester shall have knowledge of the security parameters of tunnel for decrypting the ESP packets.
-	Tester shall have access to the N9 interface between two UPFs within a PLMN.
-	Tester shall have knowledge of the confidentiality algorithm and confidentiality protection keys used for encrypting the encapsulated payload.</Purpose>
            <ExecutionSteps>The requirement mentioned in this clause is tested in accordance with the procedure mentioned in clause 4.2.3.2.4 of TS 33.117 [3].</ExecutionSteps>
            <ExpectedResults>The user data transported on N9 within a PLMN is protected.</ExpectedResults>
            <EvidenceFormat>Evidence suitable for the interface, e.g., evidence can be presented in the form of screenshot/screen-capture.</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.5	Signalling Data Protection" level="4">
          <Requirement>
            <Name>Protection of signalling data transported over N4 interface.</Name>
            <Reference>TS 33.501 [2], Clause 9.9</Reference>
            <Description>As specified in clause 9.9 in TS 33.501 [2], interfaces internal to the 5G Core can be used to transport signalling data as well as privacy sensitive material, such as user and subscription data, or other parameters, such as security keys. Therefore, confidentiality and integrity protection is required.
For the protection of the non-SBA internal interfaces, such as N4 and N9, NDS/IP is used as specified in TS 33.501 [2], clause 9.9.
Threat Reference: TR 33.926 [7], Clause L.2.3, &quot;No protection or weak protection for signalling data over N4 interface&quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPSec in N3 interface without the use of a SEG.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_CP_DATA_CONF_UPF_N4</Name>
            <Purpose>Verify that the protection mechanism implemented for signalling data transmitted over N4 conforms to selected security profile.
Procedure and execution steps:
Pre-Condition:
-	UPF and SMF network products are connected in simulated/real network environment.
-	The tunnel mode IPsec ESP and IKE certificate authentication is implemented.
-	Tester shall have knowledge of the security parameters of tunnel for decrypting the ESP packets.
-	Tester shall have access to the N4 interface between SMF and UPF.
-	Tester shall have knowledge of the confidentiality algorithm and confidentiality protection keys used for encrypting the encapsulated payload.</Purpose>
            <ExecutionSteps>The requirement mentioned in this clause is tested in accordance with the procedure mentioned in clause 4.2.3.2.4 of TS 33.117 [3].</ExecutionSteps>
            <ExpectedResults>The signalling data transported over N4 interface is protected.</ExpectedResults>
            <EvidenceFormat>Evidence suitable for the interface, e.g., evidence can be presented in the form of screenshot/screen-capture.</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.6	TEID uniqueness" level="4">
          <Requirement>
            <Name>TEID uniqueness.</Name>
            <Reference/>
            <Description>Allocation and release of CN Tunnel Info is performed when a new PDU Session is established or released. This functionality is supported either by SMF or UPF, based on operator’s configuration on the SMF as specified in TS 23.501[4], clause 5.8.2.3.1.
Tunnel Endpoint Identifier (TEID): This field unambiguously identifies a tunnel endpoint in the receiving GTP U protocol entity. The receiving end side of a GTP tunnel locally assigns the TEID value the transmitting side has to use as specified in TS 29.281[5], clause 5.1.
The TEID is a unique identifier within one IP address of a logical node as specified in TS 23.060 [6], clause 14.6.
Threat Reference: TR 33.926 [7], Clause L.2.4, &quot;Failure to assign unique TEID for a session&quot;
TEST CASE:</Description>
          </Requirement>
          <TestCase>
            <Name>TC_TEID_ID_UNIQUENESS_UPF</Name>
            <Purpose>Verify that the TEID generated by UPF under test for each new GTP tunnel is unique.</Purpose>
            <PreConditions>Test environment is set up with SMF, which may be real or simulated, and UPF under test. The tester is able to trace traffic between the UPF under test and the SMF (real or simulated). SMF configures UPF under test to generate the TEIDs.</PreConditions>
            <ExecutionSteps>1)	The tester intercepts the traffic between the UPF under test and the SMF.
2)	The tester triggers the maximum number of concurrent N4 session establishment requests.
3)	The tester captures the N4 session establishment responses sent from UPF to SMF and verifies that the F-TEID created for each generated response is unique.</ExecutionSteps>
            <ExpectedResults>The F-TEID set in each different N4 session establishment response is unique.</ExpectedResults>
            <EvidenceFormat>Files containing the triggered PFCP messages (e.g. pcap trace).</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.7	IPUPS" level="4">
          <Requirement>
            <Name>IPUPS packeting handling</Name>
            <Reference>TS 33.501[2], clause 5.9.3.4</Reference>
            <Description>The IPUPS  only forwards GTP-U packets that contain an F-TEID that belongs to an active PDU session and discard all others as specified in TS 33.501 [2], clause 5.9.3.4.
Threat Reference: TR 33.926 [7], Clause L.2.5, &quot;invalid user plane data forwarding&quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPUPS.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_IPUPS_PACKET_HANDLING</Name>
            <Purpose>Verify that the packets not belonging to an active PDU session is discarded.</Purpose>
            <PreConditions>Test environment is set up with a V-SMF, an H-SMF, an H-UPF and a gNB which may be simulated.</PreConditions>
            <ExecutionSteps>1)	The V-SMF requests the UPF with IPUPS functionality under test to establish an N4 session for a PDU session in home-routing roaming. The UPF with IPUPS functionality under test responds to the SMF with the F-TEID for the N9 tunnel towards the H-UPF, and the F-TEID for the N3 tunnel towards the gNB.
2)	The V-SMF requests the H-SMF to establish a PDU session providing the received F-TEID for the N9 tunnel.
3)	The H-SMF requests the H-UPF to establish an N4 session providing the received F-TEID for the N9 tunnel. H-UPF in the response provides its F-TEID for the N9 tunnel. The H-SMF provides the received F-TEID from the H-UPF to the V-SMF.
4)	The V-SMF requests the gNB to allocate resource for the PDU session providing the F-TEID for the N3 tunnel received at step 1. The gNB replies with its F-TEID for the N3 tunnel to the V-SMF.
5)	The V-SMF provides the UPF with IPUPS functionality under test with the received F-TEID assigned by the gNB for the N3 tunnel and the received F-TEID assigned by the H-UPF for the N9 tunnel.
6)	 The H-UPF is triggered to send GTP-U packets using the F-TEID assigned by the V-UPF for the N9 tunnel.
7)	The H-UPF is triggered to send GTP-U packets using an F-TEID different than the one assigned by V-UPF for N9 tunnel.</ExecutionSteps>
            <ExpectedResults>When the H-UPF is triggered to send GTP-U packets using the F-TEID assigned by the V-UPF for the N9 tunnel (step 6 in the execution steps), GTP-U packets are witnessed over the N3 tunnel.
When the H-UPF is triggered to send GTP-U packets using an F-TEID different than the one assigned by the V-UPF (step 7 in the execution steps), no GTP-U packets are witnessed over the N3 tunnel.</ExpectedResults>
            <EvidenceFormat>Files recording the GTP packets captured (e.g. pcap trace).</EvidenceFormat>
          </TestCase>
        </Section>
        <Section title="4.2.2.8	Protection against malformed GTP-U messages" level="4">
          <Requirement>
            <Name>Protection against malformed GTP-U messages</Name>
            <Reference>TS 33.501[2], clause 5.9.3.4</Reference>
            <Description>The IPUPS discards malformed GTP-U messages as specified in TS 33.501[2], clause 5.9.3.4.
Threat Reference: TR 33.926 [7], Clause L.2.6, &quot;Threats of malformed GTP-U messages&quot;
TEST CASE:
NOTE 1:	This test case is only applicable to UPF supporting IPUPS.</Description>
          </Requirement>
          <TestCase>
            <Name>TC_IPUPS_MALFORED_MESSAGES</Name>
            <Purpose>Verify that malformed messages are discarded by UPF.</Purpose>
            <PreConditions>The pre-conditions in clause 4.4.4 of TS 33.117 [3] apply, except that fuzzing tools supporting GTP-U protocol is available.</PreConditions>
            <ExecutionSteps>The execution steps follow those in clause 4.4.4 of TS 33.117 [3], except that the protocol the fuzzing tool is executed against is GTP-U and the interface is N9.</ExecutionSteps>
            <ExpectedResults>The expected results in clause 4.4.4 of TS 33.117 [3] apply except that the protocol and the interface contained in the testing documentation are GTP-U and N9 respectively.</ExpectedResults>
            <EvidenceFormat>The expected format of evidence in clause 4.4.4 of TS 33.117 [3] apply.</EvidenceFormat>
          </TestCase>
        </Section>
      </Section>
      <Section title="4.2.3	Technical baseline" level="3">
        <Section title="4.2.3.1	Introduction" level="4"/>
        <Section title="4.2.3.2	Protecting data and information" level="4">
          <Section title="4.2.3.2.1	Protecting data and information – general" level="5"/>
          <Section title="4.2.3.2.2	Protecting data and information – unauthorized viewing" level="5"/>
          <Section title="4.2.3.2.3	Protecting data and information in storage" level="5"/>
          <Section title="4.2.3.2.4	Protecting data and information in transfer" level="5"/>
          <Section title="4.2.3.2.5	Logging access to personal data" level="5"/>
        </Section>
        <Section title="4.2.3.3	Protecting availability and integrity" level="4"/>
        <Section title="4.2.3.4	Authentication and authorization" level="4"/>
        <Section title="4.2.3.5	Protecting sessions" level="4"/>
        <Section title="4.2.3.6	Logging" level="4"/>
      </Section>
      <Section title="4.2.4	Operating systems" level="3"/>
      <Section title="4.2.5	Web Servers" level="3"/>
      <Section title="4.2.6	Network Devices" level="3"/>
    </Section>
    <Section title="4.3	UPF-specific adaptations of hardening requirements and related test cases" level="2">
      <Section title="4.3.1	Introduction" level="3"/>
      <Section title="4.3.2	Technical baseline" level="3"/>
      <Section title="4.3.3	Operating systems" level="3"/>
      <Section title="4.3.4	Web servers" level="3"/>
      <Section title="4.3.5	Network devices" level="3"/>
      <Section title="4.3.6	Network functions in service-based architecture" level="3"/>
    </Section>
    <Section title="4.4	UPF-specific adaptations of basic vulnerability testing requirements and related test cases" level="2">
      <Section title="4.4.1	Introduction" level="3"/>
      <Section title="4.4.2	Port Scanning" level="3"/>
      <Section title="4.4.3	Vulnerability scanning" level="3"/>
      <Section title="4.4.4	Robustness and fuzz testing" level="3">
        <Section title="Annex A (informative):
Change history" level="8"/>
      </Section>
    </Section>
  </Section>
</Specification>
